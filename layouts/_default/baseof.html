<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}" dir="{{ default `ltr` .Language.LanguageDirection }}">
    <head>
        {{- partial "head/head.html" . -}}
        {{- block "head" . -}}{{ end }}
    </head>
    <body class="{{ block `body-class` . }}{{ end }}">
        {{- partial "head/colorScheme" . -}}

        {{/* The container is wider when there's any activated widget */}}
        {{- $hasWidget := false -}}
        {{- range .Site.Params.widgets -}}
            {{- if gt (len .) 0 -}}
                {{- $hasWidget = true -}}
            {{- end -}}
        {{- end -}}
        <div class="container main-container flex on-phone--column {{ if $hasWidget }}extended{{ else }}compact{{ end }}">
            {{- block "left-sidebar" . -}}
                {{ partial "sidebar/left.html" . }}
            {{- end -}}
            {{- block "right-sidebar" . -}}{{ end }}
            <main class="main full-width">
                {{- block "main" . }}{{- end }}
            </main>
        </div>
        {{ partial "footer/include.html" . }}
        <script>
  const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+";
  const texts = [
    "Добро пожаловать!",
    "Это мой блог о вебе.",
    "JavaScript — это магия.",
    "Больше, чем просто код.",
    "Просто мысли вслух."
  ];

  // Возвращает случайный символ
  function randomChar() {
    return letters[Math.floor(Math.random() * letters.length)];
  }

  // Добавляет пробелы до нужной длины
  function padToLength(str, length) {
    return str.padEnd(length, " ");
  }

  // Шаговая шифровка: один символ за раз
  function stepEncrypt(el, text, callback) {
    const maxLen = text.length;
    let current = text.split("");
    let i = 0;

    function loopChar(charIndex) {
      let count = 0;
      const originalChar = current[charIndex];

      const interval = setInterval(() => {
        current[charIndex] = randomChar();
        el.innerText = current.join("");
        count++;

        if (count >= 4) {
          current[charIndex] = randomChar(); // Финальный зашифрованный символ
          clearInterval(interval);
          el.innerText = current.join("");
          i++;
          if (i < maxLen) {
            loopChar(i); // Шифруем следующий символ
          } else {
            // Пауза перед расшифровкой
            setTimeout(() => callback(), 400);
          }
        }
      }, 80); // немного медленнее
    }

    loopChar(i);
  }

  // Шаговая расшифровка
  function stepDecrypt(el, finalText) {
    const maxLen = finalText.length;
    let current = el.innerText.split("");
    let i = 0;

    function loopDecrypt(charIndex) {
      let count = 0;

      const interval = setInterval(() => {
        current[charIndex] = randomChar();
        el.innerText = current.join("");
        count++;

        if (count >= 4) {
          current[charIndex] = finalText[charIndex];
          clearInterval(interval);
          el.innerText = current.join("");

          i++;
          if (i < maxLen) {
            loopDecrypt(i);
          }
        }
      }, 80);
    }

    loopDecrypt(i);
  }

  function animateTransition(el, newText) {
    const oldText = el.innerText;
    const maxLen = Math.max(oldText.length, newText.length);
    const paddedOld = padToLength(oldText, maxLen);
    const paddedNew = padToLength(newText, maxLen);

    el.innerText = paddedOld;

    stepEncrypt(el, paddedOld, () => {
      stepDecrypt(el, paddedNew);
    });
  }

  function updateDescriptions() {
    const elements = document.querySelectorAll(".site-description");
    elements.forEach((el) => {
      const newText = texts[Math.floor(Math.random() * texts.length)];
      animateTransition(el, newText);
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    setTimeout(updateDescriptions, 1000);
    setInterval(updateDescriptions, 30000);
  });
</script>


    </body>
</html>